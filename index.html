<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Virus Shooter</title>
    <link rel="stylesheet" href="style.css?v=1.3">
</head>

<body>
    <div id="main-container">
        <!-- リソース表示 (HUD) -->
        <div id="hud-bar">
            <div class="hud-item">
                <span class="hud-label">所持金:</span>
                <span id="stat-money-hud" class="hud-value">0</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">欠片:</span>
                <span id="stat-fragments-hud" class="hud-value">0</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">抗体P:</span>
                <span id="antibody-display" class="hud-value">0</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">撃退数:</span>
                <span id="virus-count-display" class="hud-value">0</span>
            </div>
            <button id="reset-button">リセット</button>
        </div>

        <!-- コンテンツエリア -->
        <div id="content-area">
            <!-- ゲームタブ -->
            <div id="game-tab" class="tab-content active">
                <div id="game-container">
                    <canvas id="gameCanvas" width="400" height="600"></canvas>
                    <button id="open-map-btn">マップ</button>
                </div>
                <!-- スマホ用操作ボタン -->
                <div id="mobile-controls">
                    <div id="btn-move-left" class="move-btn">
                        <img src="arrow_left.png" alt="Left">
                    </div>
                    <div id="btn-fire-left" class="fire-btn">
                        <img src="fire_btn.png" alt="Fire">
                    </div>
                    <div id="btn-fire-right" class="fire-btn">
                        <img src="fire_btn.png" alt="Fire">
                    </div>
                    <div id="btn-move-right" class="move-btn">
                        <img src="arrow_right.png" alt="Right">
                    </div>
                </div>
            </div>

            <!-- マップ選択タブ -->
            <div id="map-selection-tab" class="tab-content">
                <h2>マップ選択</h2>
                <div class="map-list">
                    <div class="map-category">
                        <div class="map-category-header" onclick="toggleMapDetails('map1-details')">
                            マップ① <span class="arrow">▼</span>
                        </div>
                        <div id="map1-details" class="map-details" style="display: block;"> <!-- デフォルト展開 -->
                            <div class="stage-list">
                                <button class="stage-btn" data-stage="map1-1" onclick="startMap('map1-1', 10)">
                                    <span class="stage-name">マップ 1-1</span>
                                    <span class="stage-quota">ノルマ: 10体</span>
                                </button>
                                <button class="stage-btn" data-stage="map1-2" onclick="startMap('map1-2', 20)" disabled>
                                    <span class="stage-name">マップ 1-2</span>
                                    <span class="stage-quota">ノルマ: 20体</span>
                                </button>
                                <button class="stage-btn" data-stage="map1-3" onclick="startMap('map1-3', 30)" disabled>
                                    <span class="stage-name">マップ 1-3</span>
                                    <span class="stage-quota">ノルマ: 30体</span>
                                </button>
                                <!-- ボスステージ -->
                                <button class="stage-btn boss-stage-btn" data-stage="map1-boss"
                                    onclick="startMap('map1-boss', 1)" disabled
                                    style="border-color: #e74c3c; background: rgba(231, 76, 60, 0.1);">
                                    <span class="stage-name" style="color: #e74c3c;">💀 1-BOSS</span>
                                    <span class="stage-quota">勝利条件: ボス撃破</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="map-category">
                        <div class="map-category-header" onclick="toggleMapDetails('map2-details')">
                            マップ② <span class="arrow">▼</span>
                        </div>
                        <div id="map2-details" class="map-details" style="display: none;">
                            <div class="stage-list">
                                <button class="stage-btn" data-stage="map2-1" onclick="startMap('map2-1', 15)" disabled>
                                    <span class="stage-name">マップ 2-1</span>
                                    <span class="stage-quota">ノルマ: 15体</span>
                                </button>
                                <button class="stage-btn" data-stage="map2-2" onclick="startMap('map2-2', 30)" disabled>
                                    <span class="stage-name">マップ 2-2</span>
                                    <span class="stage-quota">ノルマ: 30体</span>
                                </button>
                                <button class="stage-btn" data-stage="map2-3" onclick="startMap('map2-3', 50)" disabled>
                                    <span class="stage-name">マップ 2-3</span>
                                    <span class="stage-quota">ノルマ: 50体</span>
                                </button>
                                <!-- ボスステージ -->
                                <button class="stage-btn boss-stage-btn" data-stage="map2-boss"
                                    onclick="startMap('map2-boss', 1)" disabled
                                    style="border-color: #e74c3c; background: rgba(231, 76, 60, 0.1);">
                                    <span class="stage-name" style="color: #e74c3c;">💀 2-BOSS</span>
                                    <span class="stage-quota">勝利条件: ボス撃破</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- プレイヤータブ -->
            <div id="player-tab" class="tab-content">
                <h2>ステータス</h2>
                <div class="player-profile">
                    <div class="profile-left">
                        <img src="player.png" alt="Player" id="profile-img">
                    </div>
                    <div class="profile-right">
                        <div class="stat-item">
                            <span class="stat-label">攻撃力:</span>
                            <span id="stat-atk">10</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">最大体力:</span>
                            <span id="stat-hp">50</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">所持金:</span>
                            <span id="stat-money">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">欠片:</span>
                            <span id="stat-fragments">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- リワードタブ (クリア後) -->
            <div id="reward-tab" class="tab-content">
                <div id="reward-screen">
                    <div id="reward-container">
                        <h1 id="reward-title">CLEAR!</h1>
                        <div id="reward-list">
                            <div class="reward-item" id="reward-virus">
                                <span class="reward-label">ウイルス:</span>
                                <span class="reward-value">+0</span>
                            </div>
                            <div class="reward-item" id="reward-fragments">
                                <span class="reward-label">欠片:</span>
                                <span class="reward-value">+0</span>
                            </div>
                            <div class="reward-item" id="reward-money">
                                <span class="reward-label">お金:</span>
                                <span class="reward-value">+0</span>
                            </div>

                            <div id="reward-unlock-msg" class="hidden">
                                ⚠️ BOSS STAGE UNLOCKED! ⚠️
                            </div>

                        </div>
                        <button id="reward-close-btn" class="hidden">次へ</button>
                    </div>
                </div>
            </div>

            <!-- アップグレードタブ -->
            <div id="upgrade-tab" class="tab-content">
                <h2>霧吹き・施設強化</h2>
                <div class="upgrade-info">
                    <p>現在の撃退数: <span class="virus-total-count">0</span></p>
                    <p>所持抗体ポイント: <span class="antibody-count">0</span></p>
                </div>
                <div class="upgrade-list">
                    <div class="upgrade-item">
                        <span>攻撃力 (Lv <span id="atk-lv">1</span>)</span>
                        <button id="upgrade-atk">強化 (コスト: <span id="atk-cost">10</span>)</button>
                    </div>
                    <div class="upgrade-item">
                        <span>攻撃範囲 (Lv <span id="size-lv">1</span>)</span>
                        <button id="upgrade-size">強化 (コスト: <span id="size-cost">10</span>)</button>
                    </div>
                    <div class="upgrade-item">
                        <span>体力強化 (Lv <span id="hp-lv">1</span>)</span>
                        <button id="upgrade-hp">強化 (コスト: <span id="hp-cost">20</span>)</button>
                    </div>
                    <div class="upgrade-item">
                        <span>研究効率 (Lv <span id="res-lv">1</span>)</span>
                        <button id="upgrade-res">強化 (コスト: <span id="res-cost">30</span>)</button>
                    </div>
                    <div class="upgrade-item">
                        <span>α種対応 (Lv <span id="alpha-lv">0</span>)</span>
                        <button id="upgrade-alpha">強化 (コスト: 50)</button>
                    </div>
                </div>
            </div>

            <!-- 研究タブ -->
            <div id="research-tab" class="tab-content">
                <h2>研究所・精製</h2>
                <div class="research-scroll-container">
                    <div class="lab-container">
                        <h3>ウイルス研究</h3>
                        <div id="research-lab" title="クリックして研究開始">
                            <div class="lab-icon">🧪</div>
                            <span>研究所</span>
                        </div>
                        <div class="progress-container">
                            <div id="research-progress-bar"></div>
                        </div>
                        <div class="research-controls">
                            <button id="btn-minus-100" class="batch-btn">-100</button>
                            <button id="btn-minus-10" class="batch-btn">-10</button>
                            <button id="btn-minus">−1</button>
                            <span id="research-target-count">0</span>
                            <button id="btn-plus">+1</button>
                            <button id="btn-plus-10" class="batch-btn">+10</button>
                            <button id="btn-plus-100" class="batch-btn">+100</button>
                        </div>
                        <p class="research-note">撃退したウイルス 1 個につき 1 ポイントに変換（0.5秒/個）</p>
                    </div>

                    <div class="lab-divider"></div>

                    <div class="lab-container">
                        <h3>抗体精製</h3>
                        <div id="purify-lab" title="クリックして精製開始">
                            <div class="lab-icon">⚗️</div>
                            <span>精製所</span>
                        </div>
                        <div class="progress-container">
                            <div id="purify-progress-bar"></div>
                        </div>
                        <div class="research-controls">
                            <button id="btn-purify-minus-100" class="batch-btn">-100</button>
                            <button id="btn-purify-minus-10" class="batch-btn">-10</button>
                            <button id="btn-purify-minus">−1</button>
                            <span id="purify-target-count">30</span>
                            <button id="btn-purify-plus">+1</button>
                            <button id="btn-purify-plus-10" class="batch-btn">+10</button>
                            <button id="btn-purify-plus-100" class="batch-btn">+100</button>
                        </div>
                        <div class="purify-info">
                            <p>消費: <span id="purify-total-points">30</span> 抗体ポイント</p>
                            <p>必要時間: <span id="purify-total-time-display">30</span> 秒</p>
                        </div>
                        <button id="btn-purify-start" class="premium-btn"
                            style="font-size: 16px; padding: 10px 30px;">精製開始</button>
                        <p class="research-note">30ポイントにつき治療薬1個を生成します</p>
                    </div>
                </div>
            </div>

            <!-- 治療タブ -->
            <div id="treatment-tab" class="tab-content">
                <h2>病院・治療</h2>
                <div class="treatment-container">
                    <div class="treatment-money-display">
                        お金: <span id="treatment-money">0</span>
                    </div>
                    <div id="hospital-area">
                        <img src="hospital.png" alt="Hospital" id="hospital-img">
                        <div id="treatment-effect-container"></div>
                    </div>
                    <div class="medicine-display">
                        <span class="medicine-icon">💊</span> 治療薬 × <span id="medicine-count">0</span>
                    </div>
                    <button id="btn-treat" class="premium-btn">治療を行う</button>
                    <p class="treatment-note">治療薬を 1 個消費して人々を治療し、お金を獲得します</p>
                </div>
            </div>

            <!-- お金タブ (新規) -->
            <div id="money-tab" class="tab-content">
                <h2>ショップ・交換所</h2>
                <div class="shop-hud">
                    <span class="shop-hud-label">現在の所持金:</span>
                    <span id="shop-money-display" class="shop-hud-value">0</span><span class="shop-hud-unit">円</span>
                </div>

                <div class="shop-scroll-container">
                    <section class="shop-section">
                        <h3><span class="shop-icon">⚡</span> 一時ブースト</h3>
                        <div class="boost-list">
                            <div class="boost-item">
                                <div class="boost-info">
                                    <span class="boost-name">攻撃低下無効</span>
                                    <span class="boost-desc">60秒間、ウイルス接触時の攻撃力低下を無効化します。</span>
                                </div>
                                <button id="btn-buy-immune" class="buy-btn">500円で購入</button>
                            </div>
                            <div class="boost-item">
                                <div class="boost-info">
                                    <span class="boost-name">攻撃力3倍</span>
                                    <span class="boost-desc">60秒間、すべての攻撃力が3倍になります。</span>
                                </div>
                                <button id="btn-buy-double" class="buy-btn">500円で購入</button>
                            </div>
                        </div>
                    </section>

                    <div class="lab-divider"></div>

                    <section class="shop-section">
                        <h3><span class="shop-icon">🔄</span> 素材交換</h3>
                        <div class="exchange-item">
                            <div class="exchange-info">
                                <span class="boost-name">欠片の購入</span>
                                <span class="boost-desc">お金を欠片に交換します。 (レート 100円 : 1個)</span>
                            </div>
                            <button id="btn-exchange-fragment" class="buy-btn">100円で交換</button>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- タブナビゲーション -->
        <nav id="tab-nav">
            <button class="tab-btn active" data-tab="game-tab">
                <span class="tab-icon">🎮</span>
                <span class="tab-text">ゲーム</span>
            </button>
            <button class="tab-btn" data-tab="map-selection-tab">
                <span class="tab-icon">🗺️</span>
                <span class="tab-text">マップ</span>
            </button>
            <button class="tab-btn" data-tab="player-tab">
                <span class="tab-icon">👤</span>
                <span class="tab-text">ステータス</span>
            </button>
            <button class="tab-btn" data-tab="upgrade-tab">
                <span class="tab-icon">⚡</span>
                <span class="tab-text">強化</span>
            </button>
            <button class="tab-btn" data-tab="money-tab">
                <span class="tab-icon">💰</span>
                <span class="tab-text">お金</span>
            </button>
            <button class="tab-btn" data-tab="research-tab">
                <span class="tab-icon">🧪</span>
                <span class="tab-text">研究</span>
            </button>
            <button class="tab-btn" data-tab="treatment-tab">
                <span class="tab-icon">🏥</span>
                <span class="tab-text">治療</span>
            </button>
        </nav>
    </div>
    <script src="game.js?v=1.4"></script>
</body>

</html>